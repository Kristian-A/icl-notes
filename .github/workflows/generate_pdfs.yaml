name: Generate PDFs from Markdown

on: [push]

jobs:
  identify_changes:
    runs-on: ubuntu-latest
    outputs:
      changed_files: ${{ steps.getfile.outputs.files }}

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Identify changed markdown files
      id: getfile
      run: |
        files=$(git diff --name-only HEAD^ HEAD | grep ".md$")
        echo "::set-output name=files::$files"

  build:
    if: jobs.identify_changes.outputs.changed_files != ''
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: 3.9

    - name: Install pandoc
      run: sudo apt-get install pandoc

    - name: Install Python dependencies
      run: |
        pip install pypandoc

    - name: Convert MD to PDF
      if: steps.getfile.outputs.files != ''
      run: |
        IFS=" " read -ra FILES <<< "${{ steps.getfile.outputs.files }}"
        python script_name.py "${FILES[@]}"

    - name: Commit and push PDFs
      if: steps.getfile.outputs.files != ''
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add -A
        git commit -m "Add generated PDFs" || echo "No changes to commit"
        git push
